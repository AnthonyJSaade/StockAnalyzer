<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:StockAnalyzer.Avalonia.ViewModels"
        xmlns:ScottPlot="clr-namespace:ScottPlot.Avalonia;assembly=ScottPlot.Avalonia"
        x:Class="StockAnalyzer.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="1400" Height="800"
        MinWidth="1000" MinHeight="600">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*,300">
        
        <!-- Top Toolbar -->
        <Border Grid.Row="0" Grid.ColumnSpan="2" 
                Background="#2D2D30" Padding="10">
            <StackPanel Orientation="Horizontal" Spacing="15">
                <Button Name="LoadButton" 
                        Content="ðŸ“‚ Load CSV" 
                        Padding="15,8"/>
                
                <Separator Width="1" Background="#555"/>
                
                <TextBlock Text="Start:" VerticalAlignment="Center" Foreground="White"/>
                <DatePicker SelectedDate="{Binding StartDate}" Width="140"/>
                
                <TextBlock Text="End:" VerticalAlignment="Center" Foreground="White"/>
                <DatePicker SelectedDate="{Binding EndDate}" Width="140"/>
                
                <Button Content="Apply Filter" 
                        Command="{Binding ApplyDateFilterCommand}"
                        Padding="15,8"/>
            </StackPanel>
        </Border>

        <!-- Main Chart Area -->
        <Border Grid.Row="1" Grid.Column="0" 
                Background="#1E1E1E" Margin="5">
            <ScottPlot:AvaPlot Name="CandlestickChart"/>
        </Border>

        <!-- Right Sidebar -->
        <Border Grid.Row="1" Grid.Column="1" 
                Background="#252526" Margin="0,5,5,5" Padding="10">
            <ScrollViewer>
                <StackPanel Spacing="15">
                    
                    <!-- Wave Info -->
                    <TextBlock Text="ANALYSIS" 
                               FontWeight="Bold" FontSize="14" 
                               Foreground="#0078D4"/>
                    
                    <Border Background="#1E1E1E" CornerRadius="5" Padding="10">
                        <StackPanel Spacing="5">
                            <TextBlock Text="Price Range" Foreground="#888" FontSize="11"/>
                            <TextBlock Text="{Binding PriceRangeText}" 
                                       FontSize="18" FontWeight="SemiBold"
                                       Foreground="White"/>
                        </StackPanel>
                    </Border>

                    <Border Background="#1E1E1E" CornerRadius="5" Padding="10">
                        <StackPanel Spacing="5">
                            <TextBlock Text="Confirmations" Foreground="#888" FontSize="11"/>
                            <TextBlock Text="{Binding ConfirmationCount}" 
                                       FontSize="24" FontWeight="Bold"
                                       Foreground="#4EC9B0"/>
                        </StackPanel>
                    </Border>

                    <Separator Height="1" Background="#444"/>

                    <!-- Fibonacci Levels -->
                    <TextBlock Text="FIBONACCI LEVELS" 
                               FontWeight="Bold" FontSize="14" 
                               Foreground="#0078D4"/>
                    
                    <ItemsControl ItemsSource="{Binding FibonacciLevels}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#1E1E1E" CornerRadius="3" 
                                        Padding="8,5" Margin="0,2">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <TextBlock Grid.Column="0" 
                                                   Text="{Binding Label}" 
                                                   Foreground="#CE9178" Width="50"/>
                                        <TextBlock Grid.Column="1" 
                                                   Text="{Binding Price, StringFormat='${0:F2}'}" 
                                                   Foreground="White"/>
                                        <TextBlock Grid.Column="2" 
                                                   Text="{Binding Confirmations}" 
                                                   Foreground="#4EC9B0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Separator Height="1" Background="#444"/>

                    <!-- Up Waves -->
                    <TextBlock Text="UP WAVES" 
                               FontWeight="Bold" FontSize="14" 
                               Foreground="#6A9955"/>
                    
                    <ListBox ItemsSource="{Binding UpWaves}"
                             SelectedItem="{Binding SelectedWave}"
                             MaxHeight="150"
                             Background="#1E1E1E">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="#6A9955"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- Down Waves -->
                    <TextBlock Text="DOWN WAVES" 
                               FontWeight="Bold" FontSize="14" 
                               Foreground="#F14C4C"/>
                    
                    <ListBox ItemsSource="{Binding DownWaves}"
                             SelectedItem="{Binding SelectedWave}"
                             MaxHeight="150"
                             Background="#1E1E1E">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="#F14C4C"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2" Grid.ColumnSpan="2" 
                Background="#007ACC" Padding="10,5">
            <TextBlock Text="{Binding StatusMessage}" 
                       Foreground="White" FontSize="12"/>
        </Border>

    </Grid>
</Window>
